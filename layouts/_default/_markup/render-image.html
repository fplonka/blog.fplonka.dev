{{- /* Get the raw path from Markdown */ -}}
{{- $src := .Destination -}}

{{- /*
     Attempt to load an image from Hugo's global "assets/" by that same path.
     For example, if .Destination = "images/mental_gymnastics.png",
     we do resources.Get("images/mental_gymnastics.png"), which looks in assets/images/...
   */ -}}
{{- $image := resources.Get $src -}}

{{- if $image -}}
  {{- /* If found, do an actual resize (e.g., "600x" keeps aspect ratio at max width 600px). */ -}}
  {{- $resized := $image.Resize "600x" -}}
  <img src="{{ $resized.RelPermalink | safeURL }}"
       {{- with .PlainText }} alt="{{ . | safeHTML }}"{{ end }}
       {{- with .Title }} title="{{ . | safeHTML }}"{{ end }} />
  <p>
  FIRST CASE
  </p>
{{- else -}}
  {{- /*
       If not found as a resource, we simply correct "images/foo.png" to "/images/foo.png"
       so the final <img> src is absolute. 
     */ -}}
  {{- if strings.HasPrefix $src "images/" -}}
    {{- $src = print "/" $src -}}
  {{- end -}}

  <img src="{{ $src | safeURL }}"
       {{- with .PlainText }} alt="{{ . | safeHTML }}"{{ end }}
       {{- with .Title }} title="{{ . | safeHTML }}"{{ end }} />
  <p>
  SECOND CASE
  </p>
{{- end -}}
